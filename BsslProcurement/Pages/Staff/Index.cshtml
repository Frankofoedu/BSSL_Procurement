@page
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@using DcProcurement

@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@inject ProcurementDBContext _context
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<style>
    .v-center {
        display: flex;
        align-items: center;
    }

    .border-width-2 {
        border-width: 2px !important;
    }
</style>
@{
    var isSignedIn = SignInManager.IsSignedIn(User);
    var aspUser = new DcProcurement.User();

    if (isSignedIn)
    {
        aspUser = await UserManager.GetUserAsync(User);
    }
}
<div class="container bg-white shadow my-4">
    @if (isSignedIn)
    {
        if (aspUser.Email == Constants.AdminEmail)
        {
            <div class="row">

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-danger">
                            <div class="col-4 v-center">
                                <div class="bg-danger rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0"></p>
                                <a asp-page="Staff/JobViews/PreqJobs"><p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Prequalification Tasks</p></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-success">
                            <div class="col-4 v-center">
                                <div class="bg-success rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0"></p>
                                <a asp-page="/Staff/JobViews/RequisitionJobs"><p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Requisition Tasks</p></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-warning">
                            <div class="col-4 v-center">
                                <div class="bg-warning rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-dark">
                            <div class="col-4 v-center">
                                <div class="bg-dark rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-info">
                            <div class="col-4 v-center">
                                <div class="bg-info rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-light">
                            <div class="col-4 v-center">
                                <div class="bg-light rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-success">
                            <div class="col-4 v-center">
                                <div class="bg-success rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        }
        else
        {

            var curUser = await _context.Staffs.FindAsync(aspUser.Id);

            if (curUser == null)
            {
                await SignInManager.SignOutAsync();
                return;
            }

            //get number of prequalification jobs
            var PreQnotificationNum = await _context.PrequalificationJobs.Where(x => x.JobStatus == Enums.JobState.Open).CountAsync(m => m.StaffId == curUser.Id || m.StaffId == null);
            var reqNotificationNum = await _context.RequisitionJobs.Where(x => x.JobStatus == Enums.JobState.Open && x.StaffId == curUser.Id).CountAsync();
            var procNotificationNum = await _context.ProcurementJobs.Where(x => x.JobStatus == Enums.JobState.Open && x.StaffId == curUser.Id).CountAsync();


            <div class="row">

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-danger">
                            <div class="col-4 v-center">
                                <div class="bg-danger rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">@PreQnotificationNum</p>
                                <a asp-page="Staff/JobViews/PreqJobs"><p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Prequalification Tasks</p></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-success">
                            <div class="col-4 v-center">
                                <div class="bg-success rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">@reqNotificationNum</p>
                                <a asp-page="/Staff/JobViews/RequisitionJobs"><p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Requisition Tasks</p></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-warning">
                            <div class="col-4 v-center">
                                <div class="bg-warning rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">@procNotificationNum</p>
                                <a asp-page="/Staff/JobViews/ProcurementJobs"><p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Procurement Tasks</p></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-dark">
                            <div class="col-4 v-center">
                                <div class="bg-dark rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-info">
                            <div class="col-4 v-center">
                                <div class="bg-info rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-light">
                            <div class="col-4 v-center">
                                <div class="bg-light rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-4 col-sm-6 my-3">
                    <div class="container-fluid">
                        <div class="row p-2 border rounded border-width-2 border-success">
                            <div class="col-4 v-center">
                                <div class="bg-success rounded-circle text-center" style="height:50px; width:50px;">
                                    <i class="fas fa-info text-white mt-3"></i>
                                </div>
                            </div>
                            <div class="col-8 text-black-50 text-right">
                                <p class="h3 mb-0">0</p>
                                <p class="mb-0 font-italic" style="line-height:20px; font-size:16px;">Organisation information</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        }

    }
</div>
<!-- what we do section -->
<!-- //what we do section -->
<!-- middle -->
<!-- //middle -->
<!-- services -->
<!-- //services -->
<!-- stats -->
<!-- //stats -->
<!-- partners -->
<!-- //partners -->
<!-- footer -->
<!-- //footer -->
<!-- copyright bottom -->
<div class="copy-bottom bg-li py-4 border-top">
    <div class="container-fluid">
        <div class="d-md-flex px-md-3 position-relative text-center">

            <!-- copyright -->
            <div class="copy_right mx-md-auto mb-md-0 mb-3">
                <p class="text-bl let">
                    © 2019 BSSL Technologies Limited System. All rights reserved | Design by
                    <a href="#" target="_blank">BSSL</a>
                </p>
            </div>
            <!-- //copyright -->
            <!-- move top icon -->
            <a href="#home" class="move-top text-center">
                <span class="fa fa-level-up" aria-hidden="true"></span>
            </a>
            <!-- //move top icon -->
        </div>
    </div>
</div>
<!-- //copyright bottom -->